# Test info

- Name: Civic Auth Applications >> should complete full login and logout flow
- Location: /__w/civic-auth-examples/civic-auth-examples/packages/e2e/playwright/tests/civic-auth/reactjs-login.spec.ts:10:7

# Error details

```
TimeoutError: page.waitForSelector: Timeout 20000ms exceeded.
Call log:
  - waiting for locator('#civic-auth-iframe') to be hidden
    45 × locator resolved to visible <iframe scrolling="no" frameborder="0" seamless="seamless" id="civic-auth-iframe" allowfullscreen="true" data-testid="civic-auth-iframe-with-resizer" allow="camera; screen-wake-lock; publickey-credentials-get *; publickey-credentials-create *" src="https://auth-dev.civic.com/oauth/auth?client_id=demo-client-1&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2F&response_type=code&scope=openid+profile+email+offline_access&state=eyJ1dWlkIjoiNmM2N2IwMTItMWNiOC00ZGI5LTg0MTMtYWFlOGU1ZDE3NDk3IiwiZGlzcGxheU1vZGUiOi…></iframe>

    at /__w/civic-auth-examples/civic-auth-examples/packages/e2e/playwright/tests/civic-auth/reactjs-login.spec.ts:40:16
```

# Page snapshot

```yaml
- heading "Civic Auth (ReactJS)" [level=1]
- button:
  - status: Loading...
- button "Sign in (Custom)"
- iframe
- button "Close":
  - img
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 | import { allure } from 'allure-playwright';
   3 |
   4 | test.describe('Civic Auth Applications', () => {
   5 |   test.beforeEach(async ({ page }) => {
   6 |     await allure.epic('Civic Auth Applications');
   7 |     await allure.suite('Login');
   8 |     await allure.feature('React.js Login');
   9 |   });
  10 |   test('should complete full login and logout flow', async ({ page, browserName }) => {
  11 |     
  12 |     // Open the app home page
  13 |     await page.goto('http://localhost:3000');
  14 |     
  15 |     // Wait for the page to fully load with all UI elements
  16 |     await page.waitForLoadState('networkidle');
  17 |     await page.waitForLoadState('domcontentloaded');
  18 |     
  19 |     // Wait for the UserButton to be visible (the one that says "Sign in")
  20 |     await page.waitForSelector('[data-testid="sign-in-button"]', { timeout: 10000 });
  21 |     
  22 |     // Click the UserButton "Sign in" button (not the CustomSignIn button)
  23 |     await page.getByTestId('sign-in-button').click();
  24 |     
  25 |     // Chrome/Firefox use iframe flow
  26 |     // Wait for iframe to appear and load
  27 |     await page.waitForSelector('#civic-auth-iframe', { timeout: 30000 });
  28 |     
  29 |     // Click log in with dummy in the iframe
  30 |     const frame = page.frameLocator('#civic-auth-iframe');
  31 |     
  32 |     // Try to wait for the frame to load completely first
  33 |     await frame.locator('body').waitFor({ timeout: 30000 });
  34 |     
  35 |     // Look for the dummy button
  36 |     const dummyButton = frame.locator('[data-testid="civic-login-oidc-button-dummy"]');
  37 |     await dummyButton.click({ timeout: 20000 });
  38 |
  39 |     // Wait for the iframe to be gone (indicating login is complete)
> 40 |     await page.waitForSelector('#civic-auth-iframe', { state: 'hidden', timeout: 20000 });
     |                ^ TimeoutError: page.waitForSelector: Timeout 20000ms exceeded.
  41 |     
  42 |     // Confirm logged in state by checking for Ghost button in dropdown
  43 |     await expect(page.locator('#civic-dropdown-container').locator('button:has-text("Ghost")')).toBeVisible({ timeout: 20000 });
  44 |     
  45 |     // Verify custom loginSuccessUrl is not loaded
  46 |     await expect(page.url()).not.toContain('loginSuccessUrl');
  47 |
  48 |     // Click the Ghost button in dropdown
  49 |     await page.locator('#civic-dropdown-container').locator('button:has-text("Ghost")').click();
  50 |
  51 |     // Click the logout button
  52 |     await page.locator('#civic-dropdown-container').locator('button:has-text("Logout")').click();
  53 |     
  54 |     // Confirm successful logout
  55 |     await expect(page.locator('#civic-dropdown-container').locator('button:has-text("Ghost")')).not.toBeVisible();
  56 |     
  57 |     // Verify token refresh fails after logout
  58 |     const response = await page.request.post('https://auth-dev.civic.com/oauth/token', {
  59 |       form: {
  60 |         grant_type: 'refresh_token',
  61 |         refresh_token: 'storedRefreshToken', // Note: You'll need to get the actual refresh token
  62 |         client_id: process.env.VITE_CLIENT_ID || ''
  63 |       }
  64 |     });
  65 |     expect(response.status()).toBe(400);
  66 |   });
  67 | }); 
```